<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Had &amp; Požírač – Pixel animace</title>
  <style>
    :root {
      --bg-deep: #0f1f3f;
      --bg-soft: #eef2ff;
      --bg-mid: #cad5f7;
      --snake-dark: #142749;
      --snake-mid: #1f3b63;
      --snake-light: #8fb9eb;
      --snake-belly: #bed5f2;
      --snake-highlight: #dfeeff;
      --eater-shell: #fffaf0;
      --eater-shadow: #10254d;
      --eater-mouth: #c8d8ff;
      --tongue: #f45b4a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, var(--bg-soft), var(--bg-deep));
      font-family: "Press Start 2P", "VT323", monospace;
      height: 100vh;
      overflow: hidden;
      color: #0b1330;
    }

    svg {
      width: 100vw;
      height: 100vh;
      display: block;
      shape-rendering: crispEdges;
      image-rendering: pixelated;
      background: var(--bg-soft);
    }

    #flash {
      mix-blend-mode: screen;
    }

    #bits rect {
      shape-rendering: crispEdges;
    }

    .pixel {
      shape-rendering: crispEdges;
    }
  </style>
</head>
<body>
  <svg id="scene" viewBox="0 0 1920 1080" preserveAspectRatio="xMidYMid slice">
    <defs>
      <pattern id="bgGrid" width="32" height="32" patternUnits="userSpaceOnUse">
        <rect width="32" height="32" fill="var(--bg-soft)"></rect>
        <path d="M32 0H0V32" stroke="var(--bg-mid)" stroke-width="2"></path>
        <path d="M0 16H32" stroke="rgba(255,255,255,0.35)" stroke-width="1"></path>
      </pattern>

      <linearGradient id="bgFade" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="rgba(255,255,255,0.8)"></stop>
        <stop offset="100%" stop-color="rgba(10,20,60,0.35)"></stop>
      </linearGradient>

      <clipPath id="snakeClip">
        <rect id="snakeClipRect" x="48" y="380" width="1824" height="320"></rect>
      </clipPath>

      <filter id="sparkle" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur"></feGaussianBlur>
        <feMerge>
          <feMergeNode in="blur"></feMergeNode>
          <feMergeNode in="SourceGraphic"></feMergeNode>
        </feMerge>
      </filter>
    </defs>

    <rect width="1920" height="1080" fill="url(#bgGrid)"></rect>
    <rect width="1920" height="1080" fill="url(#bgFade)" opacity="0.6"></rect>

    <rect id="flash" x="0" y="0" width="1920" height="1080" fill="#ffffff" opacity="0"></rect>

    <g id="snake" clip-path="url(#snakeClip)" class="pixel">
      <rect x="48" y="492" width="1536" height="96" fill="var(--snake-mid)"></rect>
      <rect x="48" y="508" width="1536" height="64" fill="var(--snake-dark)"></rect>
      <rect x="48" y="524" width="1536" height="32" fill="var(--snake-belly)"></rect>
      <g id="snakePattern"></g>

      <g id="snakeHead">
        <rect x="1584" y="468" width="224" height="144" fill="var(--snake-dark)"></rect>
        <rect x="1600" y="484" width="192" height="112" fill="var(--snake-highlight)"></rect>
        <rect x="1600" y="540" width="192" height="32" fill="var(--snake-light)"></rect>
        <rect x="1600" y="500" width="192" height="16" fill="#a8cdf5"></rect>
        <rect x="1632" y="508" width="32" height="80" fill="var(--snake-light)"></rect>
        <rect x="1792" y="508" width="16" height="80" fill="var(--snake-light)"></rect>
        <rect id="snakeEye" x="1704" y="516" width="32" height="32" fill="var(--snake-dark)"></rect>
        <rect x="1712" y="524" width="12" height="12" fill="#ffffff"></rect>
        <polygon id="snakeTongue" points="1792,540 1856,508 1840,540 1856,572" fill="var(--tongue)"></polygon>
      </g>
    </g>

    <g id="eater" class="pixel">
      <path id="eaterShell"
            d="M -160 -88 H 48 L 112 -32 V 32 L 48 88 H -160 Z"
            fill="var(--eater-shell)"
            stroke="var(--eater-shadow)"
            stroke-width="16"></path>
      <rect x="-120" y="-56" width="128" height="112" fill="#f7f2df"></rect>
      <g id="mouthPivot" transform="translate(-16,0)">
        <polygon id="mouth" points="0,0 144,-48 144,48" fill="var(--eater-mouth)"></polygon>
      </g>
      <rect x="-72" y="-32" width="40" height="40" fill="var(--eater-shadow)"></rect>
      <rect x="-60" y="-20" width="16" height="16" fill="#ffffff"></rect>
      <rect x="32" y="-16" width="32" height="32" fill="var(--eater-shadow)"></rect>
      <rect x="32" y="8" width="24" height="16" fill="var(--eater-shadow)"></rect>
      <rect x="24" y="-40" width="16" height="16" fill="var(--eater-shadow)"></rect>
      <rect x="-136" y="40" width="32" height="16" fill="var(--eater-shadow)"></rect>
    </g>

    <polygon id="boomCircle" points="0,-20 14,-14 20,0 14,14 0,20 -14,14 -20,0 -14,-14"
             fill="none" stroke="var(--eater-shadow)" stroke-width="12" opacity="0"></polygon>

    <g id="boomRays" stroke="var(--eater-shadow)" stroke-width="16" opacity="0" class="pixel">
      <line x1="0" y1="-140" x2="0" y2="-200"></line>
      <line x1="128" y1="-64" x2="192" y2="-112"></line>
      <line x1="160" y1="40" x2="232" y2="40"></line>
      <line x1="128" y1="128" x2="192" y2="200"></line>
      <line x1="0" y1="160" x2="0" y2="224"></line>
      <line x1="-128" y1="128" x2="-192" y2="200"></line>
      <line x1="-160" y1="40" x2="-232" y2="40"></line>
      <line x1="-128" y1="-64" x2="-192" y2="-112"></line>
    </g>

    <g id="bits" class="pixel" opacity="0"></g>
  </svg>

  <script>
    const svgNS = "http://www.w3.org/2000/svg";

    // === PARAMETRY SCÉNY ===
    const VIEW_W = 1920;
    const VIEW_H = 1080;
    const GRID = 16;
    const BODY_COLS = 96;
    const HEAD_COLS = 14;
    const TIP_COLS = 4;
    const BODY_LENGTH = GRID * BODY_COLS; // 1536
    const HEAD_LENGTH = GRID * HEAD_COLS; // 224
    const TONGUE_LENGTH = GRID * TIP_COLS; // 64
    const SNAKE_LENGTH = BODY_LENGTH + HEAD_LENGTH + TONGUE_LENGTH; // 1824
    const SNAKE_HEIGHT = GRID * 6; // 96
    const snakeX = 48;
    const snakeY = VIEW_H / 2;
    const snakeBodyTop = snakeY - SNAKE_HEIGHT / 2;
    const headStartX = snakeX + BODY_LENGTH;
    const eaterBaseY = snakeY;

    // === ČASY ===
    const eatDuration = 7000;
    const explosionDuration = 1300;
    const totalDuration = eatDuration + explosionDuration;

    // === DOM ELEMENTY ===
    const snakeClipRect = document.getElementById("snakeClipRect");
    const snakePatternGroup = document.getElementById("snakePattern");
    const eater = document.getElementById("eater");
    const mouth = document.getElementById("mouth");
    const boomCircle = document.getElementById("boomCircle");
    const boomRays = document.getElementById("boomRays");
    const flashRect = document.getElementById("flash");
    const bitsGroup = document.getElementById("bits");
    const snakeEye = document.getElementById("snakeEye");
    const snakeTongue = document.getElementById("snakeTongue");

    // === POZICE ===
    const eaterStartX = snakeX - GRID * 10;
    const eaterEndX = snakeX + BODY_LENGTH + HEAD_LENGTH - GRID * 2;
    const eaterY = eaterBaseY;

    // === STAV ===
    let startTime = null;
    let explosionStarted = false;
    let bits = [];

    const baseEyeX = parseFloat(snakeEye.getAttribute("x"));
    const baseEyeY = parseFloat(snakeEye.getAttribute("y"));

    function buildSnakePixels() {
      const rows = SNAKE_HEIGHT / GRID;
      const cols = BODY_COLS;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const rect = document.createElementNS(svgNS, "rect");
          rect.setAttribute("x", snakeX + c * GRID);
          rect.setAttribute("y", snakeBodyTop + r * GRID);
          rect.setAttribute("width", GRID);
          rect.setAttribute("height", GRID);

          let color = (c % 8 < 4) ? "#1c3458" : "#24476d";
          if (r === 0) color = "#9ac0ed";
          if (r === rows - 1) color = "#162a4a";
          if ((r + c) % 6 === 0) color = "#2a5685";
          rect.setAttribute("fill", color);
          snakePatternGroup.appendChild(rect);
        }
      }
    }

    function initBits() {
      bitsGroup.innerHTML = "";
      bits = [];
      const colors = ["#f9cc5c", "#f47340", "#92c8ff", "#0f2248"];
      const count = 170;
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = 260 + Math.random() * 520;
        const size = (Math.random() > 0.5 ? GRID : GRID / 2);
        const el = document.createElementNS(svgNS, "rect");
        el.setAttribute("width", size);
        el.setAttribute("height", size);
        el.setAttribute("fill", colors[Math.floor(Math.random() * colors.length)]);
        bitsGroup.appendChild(el);
        bits.push({ el, angle, speed, size });
      }
    }

    function updateChewingMouth(elapsed) {
      const freq = 3.5;
      const t = elapsed / 1000;
      const osc = (Math.sin(t * freq * Math.PI * 2) + 1) / 2;
      const mouthLen = GRID * 9;
      const minOpen = GRID * 2;
      const maxOpen = GRID * 5;
      let open = minOpen + (maxOpen - minOpen) * osc;
      open = Math.round(open / (GRID / 2)) * (GRID / 2);
      const points = `0,0 ${mouthLen},${-open} ${mouthLen},${open}`;
      mouth.setAttribute("points", points);
    }

    function updateEyeAndTongue(elapsed) {
      const t = elapsed / 1000;
      const eyeOffsetX = Math.sin(t * 2.2) * (GRID * 0.4);
      const eyeOffsetY = Math.cos(t * 2.1) * (GRID * 0.35);
      snakeEye.setAttribute("x", baseEyeX + eyeOffsetX);
      snakeEye.setAttribute("y", baseEyeY + eyeOffsetY);

      const tongueOffset = Math.sin(t * 4.5) * (GRID * 0.8);
      snakeTongue.setAttribute("transform", `translate(${tongueOffset}, 0)`);
    }

    function step(timestamp) {
      if (!startTime) startTime = timestamp;
      let elapsed = timestamp - startTime;

      if (elapsed > totalDuration) {
        startTime = timestamp;
        elapsed = 0;
      }

      if (elapsed <= eatDuration) {
        explosionStarted = false;
        bitsGroup.setAttribute("opacity", 0);
        flashRect.setAttribute("opacity", 0);

        const p = elapsed / eatDuration;
        const newX = snakeX + SNAKE_LENGTH * p;
        const newW = Math.max(SNAKE_LENGTH * (1 - p), 0);
        snakeClipRect.setAttribute("x", newX);
        snakeClipRect.setAttribute("width", newW);

        const eaterX = eaterStartX + (eaterEndX - eaterStartX) * p;
        eater.setAttribute("transform", `translate(${eaterX}, ${eaterY})`);
        eater.style.opacity = 1;

        updateChewingMouth(elapsed);
        updateEyeAndTongue(elapsed);

        boomCircle.setAttribute("opacity", 0);
        boomRays.setAttribute("opacity", 0);
      } else {
        const tExpl = elapsed - eatDuration;
        const p = Math.min(tExpl / explosionDuration, 1);

        if (!explosionStarted) {
          explosionStarted = true;
          initBits();
        }

        const scale = 1 + 3.2 * p;
        eater.setAttribute("transform", `translate(${eaterEndX}, ${eaterY}) scale(${scale})`);
        eater.style.opacity = 1 - p;

        const maxOpen = GRID * 6;
        const points = `0,0 ${GRID * 11},${-maxOpen} ${GRID * 11},${maxOpen}`;
        mouth.setAttribute("points", points);

        const boomSize = 40 + 190 * p;
        const boomPoints = [
          `0,${-boomSize}`,
          `${boomSize * 0.7},${-boomSize * 0.7}`,
          `${boomSize},0`,
          `${boomSize * 0.7},${boomSize * 0.7}`,
          `0,${boomSize}`,
          `${-boomSize * 0.7},${boomSize * 0.7}`,
          `${-boomSize},0`,
          `${-boomSize * 0.7},${-boomSize * 0.7}`
        ].join(" ");
        boomCircle.setAttribute("points", boomPoints);
        boomCircle.setAttribute("opacity", 1 - p * 0.7);

        boomRays.setAttribute("opacity", 1 - p * 0.8);
        boomRays.setAttribute("transform", `translate(${eaterEndX}, ${eaterY}) scale(${1 + p})`);

        const flash = Math.pow(Math.sin(p * 6 * Math.PI), 2) * (1 - p);
        flashRect.setAttribute("opacity", flash);

        bitsGroup.setAttribute("opacity", 1);
        bits.forEach((b) => {
          const dist = b.speed * p;
          const x = eaterEndX + Math.cos(b.angle) * dist - b.size / 2;
          const y = eaterY + Math.sin(b.angle) * dist - b.size / 2;
          b.el.setAttribute("x", x);
          b.el.setAttribute("y", y);
        });

        snakeClipRect.setAttribute("x", snakeX + SNAKE_LENGTH);
        snakeClipRect.setAttribute("width", 0);
      }

      requestAnimationFrame(step);
    }

    buildSnakePixels();
    requestAnimationFrame(step);
  </script>
</body>
</html>

